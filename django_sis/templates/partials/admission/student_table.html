{% extends "base_admission.html" %}

{% block content %}

    <!-- Start of drawer component -->
    <div class="drawer drawer-end   xl:drawer-open  ">
        <input id="filter-drawer" type="checkbox" class="drawer-toggle">

        <!-- Main content section -->
        <div class="drawer-content flex flex-col w-full h-full">
            <div id="content-main" class="overflow-hidden mt-3 w-full h-full flex">
                <div class="card bg-base-100 w-full card-bordered flex-col flex-1 ">
                    <div class="hidden" id="hidden-search-form">
                        <form method="get">
                            


    <div class=" items-center sm:w-80 w-full">

        <div id="changelist-search" role="search" class="flex  items-center w-full">
            <div class="form-control  flex flex-row items-center rounded-sm border border-base-content/20 ps-3 w-full">
                <label for="searchbar" class="flex items-center">
                    <i class="fa fa-search text-gray-400"></i>
                </label>
                <input type="text" name="q" value="{{ search_query }}" placeholder="Search" class="input w-full border-0 focus:border-transparent focus:outline-0 transition-all input-sm focus:outline-offset-0" />
                <input type="button" value="Search" class="rounded search-submit btn btn-sm">
            </div>

            

        </div>

    </div>



                        </form>
                    </div>

                    <form id="changelist-form" method="post" novalidate="">
                        <input type="hidden" name="csrfmiddlewaretoken" value="QoDF30Zh8g6LHOSAp0loEzwQ5PwwnXTEyMupobrIbnK4f4GjgsYYBv1XXg1fQLZV">
                        <div class="flex flex-wrap gap-2 flex-row items-center justify-between px-3 pt-3">
                            


    <div class=" items-center sm:w-80 w-full">

        {% comment %} <div id="changelist-search" role="search" class="flex  items-center w-full">
            <div class="form-control  flex flex-row items-center rounded-sm border border-base-content/20 ps-3 w-full">
                <label for="searchbar" class="flex items-center">
                    <i class="fa fa-search text-gray-400"></i>
                </label>
                <input type="text" name="q" value="{{ search_query }}" placeholder="Search" class="input w-full border-0 focus:border-transparent focus:outline-0 transition-all input-sm focus:outline-offset-0" />
                <input type="button" value="Search" class="rounded search-submit btn btn-sm">
            </div>
        
            

        </div> {% endcomment %}
        <h1 style="font-size: 30px">Students List</h1>

    </div>



                            
                                

{% comment %}<div class="inline-flex items-center lg:ms-3 w-full sm:w-auto">
    
        <span class="me-1 font-bold text-sm hidden sm:block">Action:</span>
        <div id="id_action_form_container" class="w-full">
            
                
                    
                        <label for="" class="sr-only"> Action: </label>
                        <select name="action" required="" class="select !select-bordered select-sm w-full">
        
            
        
            <option value="" selected="">---------</option>

        
        
        
            
        
            <option value="delete_selected">Delete selected users</option>

        
        
        
    </select>
                    
                
                    
                
            
            
        </div>
        
            <button id="id_changelist_action_button" type="submit" class="button btn-sm btn btn-dark mx-1" title="Run the selected action" name="index" value="0" disabled="">Go</button>
        
    
</div>


<script>
        document.addEventListener("DOMContentLoaded", () => {
            // * disable 'Go' button if no action selected to avoid confusion
            const actionSelect = document.querySelector('#id_action_form_container select');
            const buttonEl = document.querySelector('#id_changelist_action_button');

            function check_select_state(element) {
                return element && element.value.trim();
            }

            // Initial check
            if (buttonEl) {
                buttonEl.disabled = !check_select_state(actionSelect);
            }

            actionSelect?.addEventListener('change', function () {
                if (buttonEl) {
                    buttonEl.disabled = !check_select_state(actionSelect);
                }
            });
        });
</script>{% endcomment %}
                            
                            <div class="object-tools inline-flex ms-auto flex-wrap max-md:justify-center gap-2 justify-between p-4 pe-1">
                                
                                    <a href="{% url 'pdf_regist_table' %}?{{ request.GET.urlencode }}" class="btn btn-secondary mb-4">Export to PDF</a>
                                    
                                    
    
    <div class="indicator  xl:hidden ">
        
        
            <button type="button" id="open-filter-drawer" class="btn btn-sm btn-primary drawer-button">
                <i class="fa fa-filter"></i>
            </button>
        
    </div>


                                    

                                
                            </div>
                        </div>
                        <div class="card-body px-3 py-1 w-full">
                            

                            
                                <div class="overflow-auto max-h-[60vh]">
                                    






            <table class="table table-sm border border-base-200 table-hover">
                <thead class="bg-base-300 text-gray-950">
                    <tr>
                        <th class="flex-1">No</th>
                        <th class="flex-1">NISN</th>
                        <th class="flex-1">Name</th>
                        <th class="flex-1">Gender</th>
                        <th class="flex-1">Active</th>
                        <th class="flex-1">NA Details</th>
                    </tr>
                </thead>
                <tbody class="flex-1">
                    {% for stdent in pnation_regist %}
                    <tr class="hover:bg-base-200">
                        <td class="flex-1">{{ forloop.counter0|add:pnation_regist.start_index }}</td> <td class="flex-1">{{ stdent.nisn }}</td>
                        <td class="flex-1"><strong>{{ stdent.registration_data.first_name }} {{ stdent.registration_data.middle_name }} {{ stdent.registration_data.last_name }}</strong></td>
                        <td class="flex-1"><strong>{{ stdent.registration_data.gender }}</strong></td>
                        {% if stdent.is_active %}
                        <td class="flex-1"><i class="text-base fa fa-circle-check text-success"></i></td>
                        {% else %}
                        <td class="flex-1"><i class="text-base fa fa-circle-xmark text-error"></i></td>
                        {% endif %}
                        {% if not stdent.is_active %}
                        <td class="flex-1">{{ stdent.na_reason }}</td>
                        {% else %}
                        <td class="flex-1">-</td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No students found matching filters.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
                                </div>
                            
                            <div class="mt-4">
                                


<div class="card-actions justify-center" style="margin-center: 10px;">
        <div class="join">
            {% if pnation_regist.has_previous %}
            <a class="join-item btn" href="?page=1{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_class %}&class={{ selected_class }}{% endif %}{% if selected_teacher %}&teacher={{ selected_teacher }}{% endif %}">&laquo;</a>
            <a class="join-item btn" href="?page={{ pnation_regist.previous_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_class %}&class={{ selected_class }}{% endif %}{% if selected_teacher %}&teacher={{ selected_teacher }}{% endif %}">&lsaquo;</a>
            {% endif %}

                Page {{ pnation_regist.number }} of {{ pnation_regist.paginator.num_pages }}

            {% if pnation_regist.has_next %}
            <a class="join-item btn" href="?page={{ pnation_regist.next_page_number }}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_class %}&class={{ selected_class }}{% endif %}{% if selected_teacher %}&teacher={{ selected_teacher }}{% endif %}">&rsaquo;</a>
            <a class="join-item btn" href="?page={{ pnation_regist.paginator.num_pages }}{% if selected_year %}&year={{ selected_year }}{% endif %}{% if selected_class %}&class={{ selected_class }}{% endif %}{% if selected_teacher %}&teacher={{ selected_teacher }}{% endif %}">&raquo;</a>
            {% endif %}
        </div>
    </div>

                            </div>
                        </div>
                    </form>
                </div>

            </div>
        </div>
        
            <!-- Filter section -->
            <div id="changelist-filter" class="drawer-side  mt-3 lg:ms-2 card-bordered  !overflow-visible  z-10 h-full">
                <label for="filter-drawer" aria-label="close sidebar" class="drawer-overlay"></label>

                <div class="card-body p-3 bg-base-100 w-80 h-full">
                    <div class="card-header flex justify-between p-2">

                    
                        {% comment %} <h2 class="font-bold">Filter</h2>
                        <button type="submit" class="btn btn-sm btn-primary">Filter</button> {% endcomment %}
                    </div>
                    
    <form method="GET" action=".">
            
        <div class="form-control  flex flex-row items-center rounded-sm border border-base-content/20 ps-3 w-full">
        <label for="searchbar" class="flex items-center">
                    <i class="fa fa-search text-gray-400"></i>
                </label>
            <input type="text" name="q" value="{{ search_query }}" placeholder="Search" class="input w-full border-0 focus:border-transparent focus:outline-0 transition-all input-sm focus:outline-offset-0" />
            </div>

            <div class="form-control">
                <label class="label"><span class="label-text font-bold">Academic Year</span></label>
                <select name="year" class="select select-bordered select-sm">
                    <option value="">All Years</option>
                    {% for ay in academic_years %}
                        <option value="{{ ay.id }}" {% if ay.id == selected_year %}selected{% endif %}>
                            {{ ay.year }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-control">
                <label class="label"><span class="label-text font-bold">Class</span></label>
                <select name="class" class="select select-bordered select-sm">
                    <option value="">All Classes</option>
                    {% for cls in classes %}
                        <option value="{{ cls.id }}" {% if cls.id == selected_class %}selected{% endif %}>
                            {{ cls.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-control">
                <label class="label"><span class="label-text font-bold">Teacher</span></label>
                <select name="teacher" class="select select-bordered select-sm">
                    <option value="">All Teachers</option>
                    {% for tch in teachers %}
                        <option value="{{ tch.id }}" {% if tch.id == selected_teacher %}selected{% endif %}>
                            {{ tch.last_name }}, {{ tch.first_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-control mt-4">
                <button type="submit" class="btn btn-sm btn-primary">Filter</button>
                <a href="." class="btn btn-sm btn-ghost">Reset</a>
        {% comment %} <div class="form-control  flex flex-row items-center rounded-sm border border-base-content/20 ps-3 w-full">
        <label for="searchbar" class="flex items-center">
                    <i class="fa fa-search text-gray-400"></i>
                </label>
            <input type="text" name="q" value="{{ search_query }}" placeholder="Search" class="input w-full border-0 focus:border-transparent focus:outline-0 transition-all input-sm focus:outline-offset-0" />
            </div> {% endcomment %}
        </div>
        




    </form>        
    </div>
    <!-- End of drawer component -->


{% endblock %}